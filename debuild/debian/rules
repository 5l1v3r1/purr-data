#!/usr/bin/make -f
# -*- makefile -*-

# Uncomment this to turn on verbose mode.
#export DH_VERBOSE=1

%:
	dh $@

override_dh_auto_configure:

override_dh_auto_build:
	cd wiringPi/wiringPi && make static
	cd l2ork_addons/raspberry_pi/disis_gpio && ln -sf $(CURDIR)/wiringPi .
	cd l2ork_addons && inst_dir=/usr ./tar_em_up.sh -F -n

override_dh_auto_install:
	mkdir -p debian/pd-l2ork && mv packages/linux_make/build/usr debian/pd-l2ork
# Default preferences file.
	install -d debian/pd-l2ork/etc/pd-l2ork && ln -s -f /usr/lib/pd-l2ork/default.settings debian/pd-l2ork/etc/pd-l2ork/default.settings
# Get rid of the Gem development files (these are provided elsewhere) and
# other stuff that's neither needed nor wanted.
	cd debian/pd-l2ork/ && rm -f Makefile README.txt
	cd debian/pd-l2ork/usr && rm -rf include/Gem lib/pkgconfig lib/pd-l2ork/extra/*/*.pd_linux_o lib/pd-l2ork/extra/*/*.la
# XXXTODO: Do we want to move these over to the doc hierarchy??
#	rm -f debian/pd-l2ork/usr/lib/pd-l2ork/extra/*-help.pd

# XXXTODO: This is deprecated, so we might have to migrate to dh_python2 in
# the future. See http://deb.li/dhs2p.
override_dh_pysupport:
	dh_pysupport -n -Xxmlrpc-test.py

override_dh_compress:
	dh_compress -X.pd -X.wav -X.aiff -X.txt -X.md

override_dh_fixperms:
	dh_fixperms
	chmod 0755 debian/pd-l2ork/usr/lib/pd-l2ork/bin/pd.tk
